<!DOCTYPE html>
<html lang="ru">
<!-- Подключаем MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title | default: site.title }}</title>
    <link rel="stylesheet" href="{{ '/css/main.css' | relative_url }}">
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* Стили для кнопки переключателя */
        #theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        #theme-toggle:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
        
        /* Стили для кнопки аниме-цитат */
        #anime-quote-btn {
            display: block;
            margin: 2rem auto;
            padding: 15px 30px;
            background: linear-gradient(45deg, #ff6b8b, #9d50bb);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(255, 107, 139, 0.4);
            transition: all 0.3s;
            max-width: 400px;
            text-align: center;
        }
        
        #anime-quote-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 107, 139, 0.6);
            background: linear-gradient(45deg, #ff4757, #8e44ad);
        }
        
        #anime-quote-btn.quote-playing {
            background: linear-gradient(45deg, #2ecc71, #3498db);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
        
        /* Контейнер для информации о цитате */
        #quote-info {
            text-align: center;
            margin: 10px auto;
            padding: 10px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            max-width: 500px;
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="/TrynaGetSmarter/">Главная</a> | 
            <a href="/TrynaGetSmarter/books/algebra/">Алгебра</a> | 
            <a href="/TrynaGetSmarter/books/combinatorics/">Комбинаторика</a>
        </nav>
        <h1><a href="{{ '/' | relative_url }}">{{ site.title }}</a></h1>
        <p>Сайт с решениями задач из книг</p>
    </header>
    
    <main>
        {{ content }}
    </main>
    
    <footer>
        <p>Сделано с ❤️ для математики | {{ site.time | date: "%Y" }}</p>
    </footer>
    
    <!-- Кнопка переключателя тем -->
    <button id="theme-toggle">🎌 Аниме фон</button>
    
    <script src="{{ '/js/toggle.js' | relative_url }}"></script>
    
    <script>
        // Переключатель аниме-фона
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.getElementById('theme-toggle');
            
            // Проверяем, была ли тема включена ранее
            if (localStorage.getItem('animeTheme') === 'enabled') {
                document.body.classList.add('temp-anime-bg');
                toggleBtn.textContent = '📚 Обычный фон';
            }
            
            // Обработчик клика
            toggleBtn.addEventListener('click', function() {
                // Переключаем класс
                document.body.classList.toggle('temp-anime-bg');
                
                // Меняем текст кнопки
                if (document.body.classList.contains('temp-anime-bg')) {
                    this.textContent = '📚 Обычный фон';
                    localStorage.setItem('animeTheme', 'enabled');
                } else {
                    this.textContent = '🎌 Аниме фон';
                    localStorage.setItem('animeTheme', 'disabled');
                }
            });
        });
    </script>
    
    <script>
        // Аниме-цитаты (добавлен после основного скрипта)
        document.addEventListener('DOMContentLoaded', function() {
            const quoteBtn = document.getElementById('anime-quote-btn');
            if (!quoteBtn) return;
            
            // Список аудиофайлов (добавьте свои файлы в assets/sounds/)
            const quotes = [
                { 
                    file: '/TrynaGetSmarter/assets/sounds/quote1.mp3',
                    title: 'Тот, кто имеет способности...',
                    anime: 'Classroom of the Elite'
                },
                { 
                    file: '/TrynaGetSmarter/assets/sounds/quote2.mp3', 
                    title: 'Что такое истина?',
                    anime: 'Naruto'
                },
                { 
                    file: '/TrynaGetSmarter/assets/sounds/quote3.mp3',
                    title: 'Огромный гриб',
                    anime: 'Avatar: The Last Airbender'
                }
            ];
            
            // Создаем контейнер для информации, если его нет
            let infoDiv = document.getElementById('quote-info');
            if (!infoDiv) {
                infoDiv = document.createElement('div');
                infoDiv.id = 'quote-info';
                infoDiv.style.cssText = `
                    text-align: center;
                    margin: 10px auto;
                    padding: 10px;
                    background: rgba(52, 152, 219, 0.1);
                    border-radius: 10px;
                    max-width: 500px;
                    display: none;
                `;
                quoteBtn.parentNode.insertBefore(infoDiv, quoteBtn.nextSibling);
            }
            
            let currentAudio = null;
            
            quoteBtn.addEventListener('click', function() {
                // Если уже играет - останавливаем
                if (currentAudio && !currentAudio.paused) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                    quoteBtn.classList.remove('quote-playing');
                    quoteBtn.textContent = '🎤 Случайная аниме-цитата';
                    infoDiv.innerHTML += '<br><em>⏹ Остановлено</em>';
                    setTimeout(() => {
                        infoDiv.style.display = 'none';
                    }, 2000);
                    currentAudio = null;
                    return;
                }
                
                // Останавливаем предыдущее воспроизведение
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                }
                
                // Выбираем случайную цитату
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                
                // Обновляем информацию
                infoDiv.innerHTML = `
                    <strong>${randomQuote.title}</strong><br>
                    <small>${randomQuote.anime}</small>
                `;
                infoDiv.style.display = 'block';
                
                // Создаем аудио элемент
                currentAudio = new Audio(randomQuote.file);
                quoteBtn.classList.add('quote-playing');
                quoteBtn.textContent = '⏸ Остановить';
                
                // События аудио
                currentAudio.addEventListener('ended', function() {
                    quoteBtn.classList.remove('quote-playing');
                    quoteBtn.textContent = '🎤 Случайная аниме-цитата';
                    setTimeout(() => {
                        infoDiv.style.display = 'none';
                    }, 3000);
                    currentAudio = null;
                });
                
                currentAudio.addEventListener('error', function() {
                    quoteBtn.classList.remove('quote-playing');
                    quoteBtn.textContent = '❌ Ошибка';
                    infoDiv.innerHTML = '<em>Файл не найден. Добавьте MP3 файлы в assets/sounds/</em>';
                    setTimeout(() => {
                        quoteBtn.textContent = '🎤 Случайная аниме-цитата';
                        infoDiv.style.display = 'none';
                    }, 3000);
                });
                
                // Запускаем воспроизведение
                currentAudio.play().catch(e => {
                    console.log('Автовоспроизведение заблокировано. Кликните на странице сначала.');
                    quoteBtn.textContent = '👆 Кликните здесь сначала';
                    infoDiv.innerHTML = '<em>Кликните на странице для разрешения звука</em>';
                    setTimeout(() => {
                        quoteBtn.textContent = '🎤 Случайная аниме-цитата';
                        infoDiv.style.display = 'none';
                    }, 2000);
                });
            });
        });
    </script>
</body>
</html>